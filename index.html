<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />

    <title>Oligopolies</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Karla&display=swap"
      rel="stylesheet"
    />
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://code.jquery.com/pep/0.4.3/pep.js"></script>
  </head>

  <body>
    <script src="script.js"></script>

    <div id="cbp-fbscroller" class="cbp-fbscroller">
      <nav>
        <a href="#fbsection1" class="cbp-fbcurrent">Section 1</a>
        <a href="#fbsection2" onclick="start()">Section 2</a>
        <a
          href="#fbsection3"
          onclick="begin([4, 11, 13, 9], ['yellow', 'blue', 'brown', 'white'], ['#year19901', '#year19902', '#year19903', '#year19904'], 4);
        "
          >Section 3</a
        >
        <a
          href="#fbsection4"
          onclick="begin([8, 11, 8, 18, 8], ['yellow', 'blue', 'brown', 'white', 'red'], ['#film1', '#film2', '#film3', '#film4', '#film5'], 5)"
          >Section 4</a
        >
        <a
          href="#fbsection5"
          onclick="begin([6, 7, 3], ['yellow', 'blue', 'brown'], ['#car1', '#car2', '#car3'], 3)"
          >Section 5</a
        >
        <a href="#fbsection6">Section 6</a>
        <a href="#fbsection7">Section 7</a>
      </nav>

      <section id="fbsection1">
        <div class="center">
          <h1>Oligipolies</h1>
        </div>
      </section>

      <section id="fbsection2">
        <div class="center">
          <p id="text">
            a state of limited competition, in which a market is shared by a
            small number of producers or sellers.
          </p>
        </div>
      </section>

      <section id="fbsection3">
        <h1 id="smaller">The Banking Industry</h1>
        <div class="partition" id="year19901"><h3>Citigroup</h3></div>
        <div class="partition" id="year19902">
          <h3>JPMorgan Chase</h3>
        </div>
        <div class="partition" id="year19903">
          <h3>Bank of America</h3>
        </div>
        <div class="partition" id="year19904">
          <h3>Wells Fargo</h3>
        </div>
        <p id="description">
          From the years 1990 to 2009, Citigroup acquired 4 companies; JPMorgan
          acquired 11 companies; Bank of America acquired 13 companies; And
          Wells Fargo acquired 9 companies.
        </p>
      </section>

      <section id="fbsection4">
        <h1 id="smaller">The Film Industry</h1>
        <div class="partition" id="film1"><h3>NBCUniversal</h3></div>
        <div class="partition" id="film2">
          <h3>Viacom</h3>
        </div>
        <div class="partition" id="film3">
          <h3>Warner Media</h3>
        </div>
        <div class="partition" id="film4">
          <h3>WaltDisney Studios</h3>
        </div>
        <div class="partition" id="film5">
          <h3>Sony Pictures</h3>
        </div>
        <p id="description">
          From the years 1912 to 2019, NBCUniversal acquired 8 companies; Viacom
          acquired 11 companies; Warner Media acquired 8 companies; WaltDisney
          Studios acquired 18 companies; Sony Pictures acquired 8 companies.
        </p>
      </section>

      <section id="fbsection5">
        <h1 id="smaller">The Automobile Industry</h1>
        <div class="partition" id="car1"><h3>General Motors</h3></div>
        <div class="partition" id="car2">
          <h3>Fiat Chrysler</h3>
        </div>
        <div class="partition" id="car3">
          <h3>Ford Motors</h3>
        </div>
        <p id="description">
          From the years 1950 to 2019, General Motors acquired 6 companies; Fiat
          Chrysler acquired 7 companies; Ford Motors acquired 3 companies;
        </p>
      </section>

      <section id="fbsection6">
        <h1 class="center" style="font-size:30px;">
          Oligopolies&nbsp;
          <span
            class="txt-rotate"
            data-period="1000"
            data-rotate='[ "invest in R&D.", "bring price stability.",  "reduces customer choice.", "are involved in collusion.", "create barriers to entry"]'
          ></span>
        </h1>
        <h2></h2>
      </section>

      <section id="fbsection7">
        <div class="body">
          <div class="flex light">
            <a href="#0" class="bttn">Are Oligopolies Good</a>
          </div>
          <div class="flex dark">
            <a href="#0" class="bttn-dark">Are Oligopolies Bad</a>
          </div>
        </div>
      </section>
    </div>

    <script>
      function begin(amount, color, locations, count) {
        for (var i = 0; i < count; ++i) {
          test(amount[i], color[i], locations[i]);
        }
      }

      function test(amount, color, location) {
        var divWidth = d3.select(".partition").node();
        var margin = { top: 50, right: 50, bottom: 50, left: 50 };
        var width = divWidth.getBoundingClientRect().width;
        var height = divWidth.getBoundingClientRect().height;

        var svg = d3
          .select(location)
          .append("svg")
          .attr("width", width)
          .attr("height", height)
          .append("g")
          .attr("transform", "translate(" + [margin.left, margin.top] + ")");

        var config = {
          radius: 5,
          gridLength: 10,
          gridPadding: 10
        };

        var defs = svg.append("defs");
        var filter = defs.append("filter").attr("id", "gooey");
        filter
          .append("feGaussianBlur")
          .attr("in", "SourceGraphic")
          .attr("stdDeviation", config.radius * 1.8)
          .attr("result", "blur");
        filter
          .append("feColorMatrix")
          .attr("class", "blurValues")
          .attr("in", "blur")
          .attr("mode", "matrix")
          .attr(
            "values",
            "1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 " + config.radius + " -6"
          )
          .attr("result", "gooey");
        filter
          .append("feBlend")
          .attr("in", "SourceGraphic")
          .attr("in2", "gooey")
          .attr("operator", "atop");

        var data = d3.range(amount).map(function(i) {
          return {
            r: config.radius,
            colour: color
          };
        });

        var simulation = d3
          .forceSimulation(data)
          .force("x", d3.forceX(width / 2))
          .force("y", d3.forceY(height / 2))
          .force("collide", d3.forceCollide(config.radius + 1.5).iterations(2))
          .stop();

        var circleGroup = svg.append("g").style("filter", "url(#gooey)");

        var smallCircles = circleGroup
          .append("g")
          .selectAll("circle")
          .data(data)
          .enter()
          .append("circle")
          .attr("class", "small-circle")
          .attr("r", config.radius)
          .attr(
            "cx",
            (d, i) =>
              (d.x =
                (i % config.gridLength) *
                (config.gridPadding + config.radius * 2))
          )
          .attr(
            "cy",
            (d, i) =>
              (d.y =
                Math.floor(i / config.gridLength) *
                (config.gridPadding + config.radius * 2))
          )
          .attr("fill", d => d.colour);

        var bigCircle = circleGroup
          .append("g")
          .append("circle")
          .attr("class", "big-circle")
          .attr("cx", width / 2)
          .attr("cy", height / 2)
          .attr("r", 0)
          .style("fill", color);

        function clusterDots() {
          // Interpolate between gooey filter and no gooey filter
          transitionGoo(3000);

          for (var i = 0; i < 120; ++i) simulation.tick();

          d3.selectAll(".small-circle")
            .transition()
            .duration(1500)
            .delay((d, i) => calculateDistance(d, [width / 2, height / 2]) * 30)
            .attr("cx", d => d.x)
            .attr("cy", d => d.y);

          d3.select(".big-circle")
            .transition()
            .delay(700)
            .duration(2500)
            .attr("r", Math.sqrt(data.length) * 1.5 * config.radius);
        }

        function separateDots() {
          transitionGooBack(2000);

          d3.select(".big-circle")
            .transition()
            .duration(2100)
            .attr("r", 0);

          d3.selectAll(".small-circle")
            .transition()
            .duration(1500)
            .delay(
              (d, i) =>
                1500 +
                (config.radius -
                  calculateDistance(d, [width / 2, height / 2])) *
                  30
            )
            .attr(
              "cx",
              (d, i) =>
                (i % config.gridLength) *
                (config.gridPadding + config.radius * 2)
            )
            .attr(
              "cy",
              (d, i) =>
                Math.floor(i / config.gridLength) *
                (config.gridPadding + config.radius * 2)
            );
        }

        function loop() {
          setTimeout(clusterDots, 1000);
        }

        loop();

        function transitionGoo(duration) {
          d3.selectAll(".blurValues")
            .transition()
            .duration(duration)
            .attrTween("values", function() {
              return d3.interpolateString(
                "1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 6 -6",
                "1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 " +
                  config.radius * 8 +
                  " -6"
              );
            });
        }

        function transitionGooBack(duration) {
          d3.selectAll(".blurValues")
            .transition()
            .duration(duration)
            .attrTween("values", function() {
              return d3.interpolateString(
                "1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 " +
                  config.radius * 8 +
                  " -6",
                "1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 6 -6"
              );
            });
        }

        function calculateDistance(d, point) {
          return Math.sqrt(
            Math.pow(point[0] - d.x, 2) + Math.pow(point[1] - d.y, 2)
          );
        }
      }
    </script>
    <script src="animation.js"></script>
  </body>
</html>
